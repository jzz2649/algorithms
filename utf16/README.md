# utf16

你遇到过以下问题吗

> "这是一个😊".length !== 5

js中的字符串使用的DOMString类型，也就是utf16，unicode一种实现方式，关于unicode可查看[`utf8`](/algorithms/tree/main/utf8#readme)章节

## utf16格式

> 一般两个字节够我们表示所有可书写字符(基本多文种平面BMP)，但由于unicode在不断的添加一些特殊的符号，比如😊，那两个字节不够用，所以utf16再扩充2个字节，最多可用4个字节表示一个符号

- 二个字节 xxxxxxxx xxxxxxxx
- 四个字节 110110xx xxxxxxxx 110111xx xxxxxxxx

## utf16格式说明

由于四个字节使用代理对来辅助，前两个字节以54开头，后两个字节以55开头，所以如果二个字节存在54和55开头，就会被当成4个字节来处理，所以在定义字符编码时侯会避开这两个区间[11011000 00000000, 11011011 00000000], [11011100 00000000, 11011111 00000000]

## 问题

"😊".length === 2
首先获取 😊 unicode编码 '😊'.codePointAt() 为128522(0x1f60a), 超过2字节最大值0xFFFF(65535), 所以使用四个字节，js以两字节的长度为1，所以四个字节长度为2。

## 示例讲解

"😊" 编码为128522，减去65536(0xFFFF+1=>0x10000)差为62986，62986转成二进制 0b1111011000001010 根据上面格式，我们先去掉最低8位00001010，还剩111110110，低代理位110111xx，有效2位，所以我们继续去掉2位10，还剩111101，足够补全8位，所以此时分解结束，不够的位使用0补充，我们最终得到11011000 00111101 11011110 00001010，转化成16进制d83dde0a，此时使用'\ud83d\ude0a'在控制台输出看看。

## BOM (byte order mark)

这个用来表示"字节序", 比如字符 "牛" 的编码为29275 16进制 725b，此时高位在前，低位在后，我们称之为"大端序"，如果是5b72，此时低位在前，高位再后，我们称之为"小端序"，由于我们人来阅读习惯大的在前，小的灾后，比如日期2021/11/2，而计算机由于计算方便，或者内存从低到高，采用"小端序"存储，当然这依赖与你的设置及存储方式，所以对于"牛"使用5b72来解析的话，必然失败，这是用就用到的BOM来标记他的字节序的格式，才能以正确的方式解析，由于utf16是以2个字节处理，所以对于4个字节d83dde0a，也只会已两个字节翻转得到3dd80ade

## 代码实现

未完待续...